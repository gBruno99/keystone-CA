diff --git a/include/mbedtls/mbedtls_config.h b/include/mbedtls/mbedtls_config.h
index 89d565971..bb6d4ce2a 100644
--- a/include/mbedtls/mbedtls_config.h
+++ b/include/mbedtls/mbedtls_config.h
@@ -140,7 +140,7 @@
  *       regardless of the setting of MBEDTLS_HAVE_TIME, unless
  *       MBEDTLS_TIMING_ALT is used. See timing.c for more information.
  */
-#define MBEDTLS_HAVE_TIME
+//#define MBEDTLS_HAVE_TIME
 
 /**
  * \def MBEDTLS_HAVE_TIME_DATE
@@ -161,7 +161,7 @@
  * mbedtls_platform_gmtime_r() at compile-time by using the macro
  * MBEDTLS_PLATFORM_GMTIME_R_ALT.
  */
-#define MBEDTLS_HAVE_TIME_DATE
+//#define MBEDTLS_HAVE_TIME_DATE
 
 /**
  * \def MBEDTLS_PLATFORM_MEMORY
@@ -185,7 +185,7 @@
  *
  * Enable this layer to allow use of alternative memory allocators.
  */
-//#define MBEDTLS_PLATFORM_MEMORY
+#define MBEDTLS_PLATFORM_MEMORY
 
 /**
  * \def MBEDTLS_PLATFORM_NO_STD_FUNCTIONS
@@ -204,7 +204,7 @@
  * Uncomment to prevent default assignment of standard functions in the
  * platform layer.
  */
-//#define MBEDTLS_PLATFORM_NO_STD_FUNCTIONS
+#define MBEDTLS_PLATFORM_NO_STD_FUNCTIONS
 
 /**
  * \def MBEDTLS_PLATFORM_EXIT_ALT
@@ -230,12 +230,12 @@
  * platform function
  */
 //#define MBEDTLS_PLATFORM_SETBUF_ALT
-//#define MBEDTLS_PLATFORM_EXIT_ALT
+#define MBEDTLS_PLATFORM_EXIT_ALT
 //#define MBEDTLS_PLATFORM_TIME_ALT
-//#define MBEDTLS_PLATFORM_FPRINTF_ALT
-//#define MBEDTLS_PLATFORM_PRINTF_ALT
-//#define MBEDTLS_PLATFORM_SNPRINTF_ALT
-//#define MBEDTLS_PLATFORM_VSNPRINTF_ALT
+#define MBEDTLS_PLATFORM_FPRINTF_ALT
+#define MBEDTLS_PLATFORM_PRINTF_ALT
+#define MBEDTLS_PLATFORM_SNPRINTF_ALT
+#define MBEDTLS_PLATFORM_VSNPRINTF_ALT
 //#define MBEDTLS_PLATFORM_NV_SEED_ALT
 //#define MBEDTLS_PLATFORM_SETUP_TEARDOWN_ALT
 //#define MBEDTLS_PLATFORM_MS_TIME_ALT
@@ -1058,7 +1058,7 @@
  *
  * Enable functions that use the filesystem.
  */
-#define MBEDTLS_FS_IO
+//#define MBEDTLS_FS_IO
 
 /**
  * \def MBEDTLS_NO_DEFAULT_ENTROPY_SOURCES
@@ -1081,7 +1081,7 @@
  *
  * Uncomment this macro to disable the built-in platform entropy functions.
  */
-//#define MBEDTLS_NO_PLATFORM_ENTROPY
+#define MBEDTLS_NO_PLATFORM_ENTROPY
 
 /**
  * \def MBEDTLS_ENTROPY_FORCE_SHA256
@@ -2559,7 +2559,7 @@
  *
  * This module provides a generic entropy pool
  */
-#define MBEDTLS_ENTROPY_C
+//#define MBEDTLS_ENTROPY_C
 
 /**
  * \def MBEDTLS_ERROR_C
@@ -2629,7 +2629,7 @@
  *
  * Uncomment to enable the LMS verification algorithm and public key operations.
  */
-#define MBEDTLS_LMS_C
+//#define MBEDTLS_LMS_C
 
 /**
  * \def MBEDTLS_LMS_PRIVATE
@@ -2743,7 +2743,7 @@
  *
  * This module provides networking routines.
  */
-#define MBEDTLS_NET_C
+//#define MBEDTLS_NET_C
 
 /**
  * \def MBEDTLS_OID_C
@@ -2780,7 +2780,7 @@
  *
  * This modules adds support for the VIA PadLock on x86.
  */
-#define MBEDTLS_PADLOCK_C
+//#define MBEDTLS_PADLOCK_C
 
 /**
  * \def MBEDTLS_PEM_PARSE_C
@@ -2962,7 +2962,7 @@
  *           or MBEDTLS_PSA_CRYPTO_EXTERNAL_RNG.
  *
  */
-#define MBEDTLS_PSA_CRYPTO_C
+//#define MBEDTLS_PSA_CRYPTO_C
 
 /**
  * \def MBEDTLS_PSA_CRYPTO_SE_C
@@ -2991,7 +2991,7 @@
  *           either MBEDTLS_PSA_ITS_FILE_C or a native implementation of
  *           the PSA ITS interface
  */
-#define MBEDTLS_PSA_CRYPTO_STORAGE_C
+//#define MBEDTLS_PSA_CRYPTO_STORAGE_C
 
 /**
  * \def MBEDTLS_PSA_ITS_FILE_C
@@ -3003,7 +3003,7 @@
  *
  * Requires: MBEDTLS_FS_IO
  */
-#define MBEDTLS_PSA_ITS_FILE_C
+//#define MBEDTLS_PSA_ITS_FILE_C
 
 /**
  * \def MBEDTLS_RIPEMD160_C
@@ -3333,7 +3333,7 @@
  *
  * Module:  library/timing.c
  */
-#define MBEDTLS_TIMING_C
+//#define MBEDTLS_TIMING_C
 
 /**
  * \def MBEDTLS_VERSION_C
diff --git a/include/mbedtls/platform.h b/include/mbedtls/platform.h
index f65158719..f506feb05 100644
--- a/include/mbedtls/platform.h
+++ b/include/mbedtls/platform.h
@@ -465,6 +465,13 @@ int mbedtls_platform_setup(mbedtls_platform_context *ctx);
  */
 void mbedtls_platform_teardown(mbedtls_platform_context *ctx);
 
+int atoi(const char *nptr);
+int rand(void);
+void srand(unsigned int seed);
+int strcmp(const char *string1, const char *string2);
+char *strchr(const char *str, int c);
+char *strstr(const char *str, const char *strSearch);
+
 #ifdef __cplusplus
 }
 #endif
diff --git a/library/alignment.h b/library/alignment.h
index 41823485a..647118308 100644
--- a/library/alignment.h
+++ b/library/alignment.h
@@ -189,6 +189,7 @@ inline void mbedtls_put_unaligned_uint64(void *p, uint64_t x)
  * compiler may be able to detect and transform into the relevant bswap or
  * similar instruction.
  */
+#undef MBEDTLS_BSWAP16
 #if !defined(MBEDTLS_BSWAP16)
 static inline uint16_t mbedtls_bswap16(uint16_t x)
 {
@@ -199,6 +200,7 @@ static inline uint16_t mbedtls_bswap16(uint16_t x)
 #define MBEDTLS_BSWAP16 mbedtls_bswap16
 #endif /* !defined(MBEDTLS_BSWAP16) */
 
+#undef MBEDTLS_BSWAP32
 #if !defined(MBEDTLS_BSWAP32)
 static inline uint32_t mbedtls_bswap32(uint32_t x)
 {
@@ -211,6 +213,7 @@ static inline uint32_t mbedtls_bswap32(uint32_t x)
 #define MBEDTLS_BSWAP32 mbedtls_bswap32
 #endif /* !defined(MBEDTLS_BSWAP32) */
 
+#undef MBEDTLS_BSWAP64
 #if !defined(MBEDTLS_BSWAP64)
 static inline uint64_t mbedtls_bswap64(uint64_t x)
 {
diff --git a/library/platform.c b/library/platform.c
index b15b7b29a..28080bd05 100644
--- a/library/platform.c
+++ b/library/platform.c
@@ -411,4 +411,82 @@ void mbedtls_platform_teardown(mbedtls_platform_context *ctx)
 }
 #endif /* MBEDTLS_PLATFORM_SETUP_TEARDOWN_ALT */
 
+int atoi(const char *nptr)
+{
+    int val = 0;
+    int i = 0;
+    while(nptr[i]!='\0'){
+        if(nptr[i]<'0'||nptr[i]>'9')
+            return 0;
+        val *= 10;
+        val += (int) nptr[i] - 48;
+        i++;
+    }
+    return val;
+}
+
+static unsigned long int next = 1;
+
+int rand(void)
+{  
+    // RAND_MAX assumed to be 32767
+    next = next * 1103515245 + 12345;
+    return (unsigned int)(next/65536) % 32768;
+}
+
+void srand(unsigned int seed)
+{
+    next = seed;
+}
+
+int strcmp(const char *string1, const char *string2)
+{
+    while(*string1 && (*string1 == *string2))
+    {
+        string1++;
+        string2++;
+    }
+    return *(const unsigned char*)string1 - *(const unsigned char*)string2;
+}
+
+char *strchr(const char *str, int c)
+{
+	char ch;
+
+	ch = c;
+	for (;; ++str) {
+		if (*str == ch)
+			return ((char *)str);
+		if (*str == '\0')
+			return (NULL);
+	}
+	/* NOTREACHED */
+}
+
+char *strstr(const char *str, const char *strSearch)
+{
+    char *a, *b;
+
+    b = (char*) strSearch;
+    if (*b == 0) {
+	    return (char*) str;
+    }
+    for ( ; *str != 0; str += 1) {
+        if (*str != *b) {
+            continue;
+        }
+        a = (char*) str;
+        while (1) {
+            if (*b == 0) {
+                return (char*) str;
+            }
+            if (*a++ != *b++) {
+                break;
+            }
+        }
+        b = (char*) strSearch;
+    }
+    return NULL;
+}
+
 #endif /* MBEDTLS_PLATFORM_C */
diff --git a/library/platform_util.c b/library/platform_util.c
index e903f8ed3..4f5e5252f 100644
--- a/library/platform_util.c
+++ b/library/platform_util.c
@@ -51,9 +51,9 @@
 
 // Detect platforms known to support explicit_bzero()
 #if defined(__GLIBC__) && (__GLIBC__ >= 2) && (__GLIBC_MINOR__ >= 25)
-#define MBEDTLS_PLATFORM_HAS_EXPLICIT_BZERO 1
+//#define MBEDTLS_PLATFORM_HAS_EXPLICIT_BZERO 1
 #elif (defined(__FreeBSD__) && (__FreeBSD_version >= 1100037)) || defined(__OpenBSD__)
-#define MBEDTLS_PLATFORM_HAS_EXPLICIT_BZERO 1
+//#define MBEDTLS_PLATFORM_HAS_EXPLICIT_BZERO 1
 #endif
 
 #if !defined(MBEDTLS_PLATFORM_ZEROIZE_ALT)
diff --git a/library/ssl_msg.c b/library/ssl_msg.c
index 18c19f93e..ef155d30f 100644
--- a/library/ssl_msg.c
+++ b/library/ssl_msg.c
@@ -2010,13 +2010,14 @@ int mbedtls_ssl_fetch_input(mbedtls_ssl_context *ssl, size_t nb_want)
 
             MBEDTLS_SSL_DEBUG_MSG(3, ("f_recv_timeout: %lu ms", (unsigned long) timeout));
 
+            mbedtls_printf("mbedtls_ssl_fetch_input - 1: ok\n");
             if (ssl->f_recv_timeout != NULL) {
                 ret = ssl->f_recv_timeout(ssl->p_bio, ssl->in_hdr, len,
                                           timeout);
             } else {
                 ret = ssl->f_recv(ssl->p_bio, ssl->in_hdr, len);
             }
-
+            mbedtls_printf("mbedtls_ssl_fetch_input - 2: ret=%d\n", ret);
             MBEDTLS_SSL_DEBUG_RET(2, "ssl->f_recv(_timeout)", ret);
 
             if (ret == 0) {
@@ -2073,6 +2074,7 @@ int mbedtls_ssl_fetch_input(mbedtls_ssl_context *ssl, size_t nb_want)
             if (mbedtls_ssl_check_timer(ssl) != 0) {
                 ret = MBEDTLS_ERR_SSL_TIMEOUT;
             } else {
+                mbedtls_printf("mbedtls_ssl_fetch_input - 3: ok\n");
                 if (ssl->f_recv_timeout != NULL) {
                     ret = ssl->f_recv_timeout(ssl->p_bio,
                                               ssl->in_hdr + ssl->in_left, len,
@@ -2081,8 +2083,9 @@ int mbedtls_ssl_fetch_input(mbedtls_ssl_context *ssl, size_t nb_want)
                     ret = ssl->f_recv(ssl->p_bio,
                                       ssl->in_hdr + ssl->in_left, len);
                 }
+                mbedtls_printf("mbedtls_ssl_fetch_input - 4: ret=%d\n", ret);
             }
-
+            mbedtls_printf("mbedtls_ssl_fetch_input - 5: ok\n");
             MBEDTLS_SSL_DEBUG_MSG(2, ("in_left: %" MBEDTLS_PRINTF_SIZET
                                       ", nb_want: %" MBEDTLS_PRINTF_SIZET,
                                       ssl->in_left, nb_want));
diff --git a/library/ssl_tls.c b/library/ssl_tls.c
index 331bb79db..1fa749bb3 100644
--- a/library/ssl_tls.c
+++ b/library/ssl_tls.c
@@ -1383,12 +1383,12 @@ int mbedtls_ssl_setup(mbedtls_ssl_context *ssl,
     size_t out_buf_len = MBEDTLS_SSL_OUT_BUFFER_LEN;
 
     ssl->conf = conf;
-
+    mbedtls_printf("mbedtls_ssl_setup - 1\n");
     if ((ret = ssl_conf_check(ssl)) != 0) {
         return ret;
     }
     ssl->tls_version = ssl->conf->max_tls_version;
-
+    mbedtls_printf("mbedtls_ssl_setup - 2\n");
     /*
      * Prepare base structures
      */
@@ -1399,6 +1399,7 @@ int mbedtls_ssl_setup(mbedtls_ssl_context *ssl,
 #if defined(MBEDTLS_SSL_VARIABLE_BUFFER_LENGTH)
     ssl->in_buf_len = in_buf_len;
 #endif
+    mbedtls_printf("mbedtls_ssl_setup - 3: in_buf_len=%lu\n", in_buf_len);
     ssl->in_buf = mbedtls_calloc(1, in_buf_len);
     if (ssl->in_buf == NULL) {
         MBEDTLS_SSL_DEBUG_MSG(1, ("alloc(%" MBEDTLS_PRINTF_SIZET " bytes) failed", in_buf_len));
@@ -1409,23 +1410,24 @@ int mbedtls_ssl_setup(mbedtls_ssl_context *ssl,
 #if defined(MBEDTLS_SSL_VARIABLE_BUFFER_LENGTH)
     ssl->out_buf_len = out_buf_len;
 #endif
+    mbedtls_printf("mbedtls_ssl_setup - 4\n");
     ssl->out_buf = mbedtls_calloc(1, out_buf_len);
     if (ssl->out_buf == NULL) {
         MBEDTLS_SSL_DEBUG_MSG(1, ("alloc(%" MBEDTLS_PRINTF_SIZET " bytes) failed", out_buf_len));
         ret = MBEDTLS_ERR_SSL_ALLOC_FAILED;
         goto error;
     }
-
+    mbedtls_printf("mbedtls_ssl_setup - 5\n");
     mbedtls_ssl_reset_in_out_pointers(ssl);
-
+    mbedtls_printf("mbedtls_ssl_setup - 6\n");
 #if defined(MBEDTLS_SSL_DTLS_SRTP)
     memset(&ssl->dtls_srtp_info, 0, sizeof(ssl->dtls_srtp_info));
 #endif
-
+    mbedtls_printf("mbedtls_ssl_setup - 7\n");
     if ((ret = ssl_handshake_init(ssl)) != 0) {
         goto error;
     }
-
+    mbedtls_printf("mbedtls_ssl_setup - 8\n");
     return 0;
 
 error:
diff --git a/programs/test/udp_proxy.c b/programs/test/udp_proxy.c
index ac527f257..4d631fe04 100644
--- a/programs/test/udp_proxy.c
+++ b/programs/test/udp_proxy.c
@@ -258,7 +258,7 @@ static void get_options(int argc, char *argv[])
             buf = mbedtls_calloc(1, len + 1);
             if (buf == NULL) {
                 mbedtls_printf(" Allocation failure\n");
-                exit(1);
+                mbedtls_exit(1);
             }
             memcpy(buf, q, len + 1);
 
